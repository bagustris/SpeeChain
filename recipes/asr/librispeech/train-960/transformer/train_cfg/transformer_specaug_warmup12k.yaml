### Author: Heli Qi
### Affiliation: NAIST
### Date: 2022.09


### --- Reference Values --- ###
# These values can be referred and reused by the representer '!ref' like the way below
token_root: /ahc/work4/heli-qi/euterpe-heli-qi/datasets/speech_text/librispeech/data/subword/train-960/bpe5k
data_root: /ahc/work4/heli-qi/euterpe-heli-qi/datasets/speech_text/librispeech/data/wav/train-960
d_model: 512
fdfwd_dim: 2048
dropout: 0.1
### ------------------------ ###


model:
  model_type: asr.ASR
  model_conf:
    customize_conf:
      token_type: subword
      token_vocab: !ref <token_root>/vocab
      spk_list: !ref <data_root>/spk_list

  module_conf:
    frontend:
      type: speech2mel
      conf:
        preemphasis: 0.97
        hop_length: 0.010
        win_length: 0.025
        n_mels: 80

    normalize:
      norm_type: global

    specaug: True

    enc_prenet:
      type: conv2d
      conf:
        conv_dims:
          - 64
          - 64
        conv_kernel: 3
        conv_stride: 2
        conv_batchnorm: true
        lnr_dims: !ref <d_model>
        lnr_dropout: !ref <dropout>

    encoder:
      type: transformer
      conf:
        posenc_dropout: !ref <dropout>
        d_model: !ref <d_model>
        num_heads: 8
        num_layers: 12
        att_dropout: !ref <dropout>
        fdfwd_dim: !ref <fdfwd_dim>
        fdfwd_dropout: !ref <dropout>
        res_dropout: !ref <dropout>
        layernorm_first: true

    dec_prenet:
      type: embed
      conf:
        embedding_dim: !ref <d_model>

    decoder:
      type: transformer
      conf:
        posenc_dropout: !ref <dropout>
        d_model: !ref <d_model>
        num_heads: 8
        num_layers: 6
        att_dropout: !ref <dropout>
        fdfwd_dim: !ref <fdfwd_dim>
        fdfwd_dropout: !ref <dropout>
        res_dropout: !ref <dropout>
        layernorm_first: true


  criterion_conf:
    cross_entropy:
      label_smoothing: 0.1


optim_sches:
  type: noam.Noamlr
  conf:
    optim_type: Adam
    optim_conf:
      betas:
        - 0.9
        - 0.98
      eps: 1.0e-9
    warmup_steps: 12000