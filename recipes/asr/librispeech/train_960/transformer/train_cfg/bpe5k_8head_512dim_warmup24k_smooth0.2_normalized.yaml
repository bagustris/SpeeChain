model:
  model_type: asr.ASR
  model_conf:
    init: xavier
    customize_conf:
      token_type: subword
      token_vocab: /ahc/work4/heli-qi/euterpe-heli-qi/datasets/speech_text/librispeech/data/subword/train_960/bpe5k/vocab
      token_model: /ahc/work4/heli-qi/euterpe-heli-qi/datasets/speech_text/librispeech/data/subword/train_960/bpe5k/model

  module_conf:
    encoder:
      type: encoder.asr.ASREncoder
      conf:
        frontend:
          type: frontend.speech2mel.Speech2MelSpec
          conf:
            sr: 16000
            preemphasis: 0.97
            n_fft: 2048
            hop_length: 0.0125
            win_length: 0.05
            n_mels: 80
            fmin: 125
            fmax: 7600

        prenet:
          type: prenet.conv2d.Conv2dPrenet
          conf:
            conv_dims:
              - 64
              - 64
            conv_kernel: 3
            conv_stride: 2
            conv_batchnorm: true
            lnr_dims:
              - 512
            lnr_dropout:
              - 0.1

        encoder:
          type: transformer.encoder.TransformerEncoder
          conf:
            posenc_type: sep
            posenc_maxlen: 5000
            posenc_dropout: 0.1
            d_model: 512
            num_heads: 8
            num_layers: 12
            att_dropout: 0.1
            fdfwd_dim: 2048
            fdfwd_dropout: 0.1
            res_dropout: 0.1
            layernorm_first: true

    decoder:
      type: decoder.asr.ASRDecoder
      conf:
        vocab_size: 5000

        prenet:
          type: prenet.embed.EmbedPrenet
          conf:
            embedding_dim: 512

        decoder:
          type: transformer.decoder.TransformerDecoder
          conf:
            posenc_type: sep
            posenc_maxlen: 5000
            posenc_dropout: 0.1
            d_model: 512
            num_heads: 8
            num_layers: 6
            att_dropout: 0.1
            fdfwd_dim: 2048
            fdfwd_dropout: 0.1
            res_dropout: 0.1
            layernorm_first: true

        postnet:
          type: postnet.token.TokenPostnet


  criterion_conf:
    cross_entropy:
      type: cross_entropy.CrossEntropy
      conf:
        label_smoothing: 0.2
        is_normalized: True

    accuracy:
      type: accuracy.Accuracy

    error_rate:
      type: error_rate.ErrorRate


optim_sches:
  noam_adam:
    type: noam.Noamlr
    conf:
      optim_type: Adam
      optim_conf:
        betas:
          - 0.9
          - 0.98
        eps: 1.0e-9
      d_model: 512
      warmup_steps: 24000