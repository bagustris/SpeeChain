### Author: Heli Qi
### Affiliation: NAIST
### Date: 2022.09


### --- Reference Values --- ###
# These values can be referred and reused by the representer '!ref' like the way below
token_root: !ref datasets/speech_text/ljspeech/data/char/train/full_tokens/normal
layer_num: 6
head_num: 8
d_model: 512
fdfwd_dim: 2048
dropout: 0.5
trmf_dropout: 0.1
### ------------------------ ###


model:
  model_type: tts.TTS
  model_conf:
    customize_conf:
      token_type: char
      token_vocab: !ref <token_root>/vocab
      reduction_factor: 1

  module_conf:
    enc_emb:
      type: emb
      conf:
        embedding_dim: !ref <d_model>

    enc_prenet:
      type: conv1d
      conf:
        conv_dims:
          - !ref <d_model>
          - !ref <d_model>
          - !ref <d_model>
        conv_kernel: 5
        conv_batchnorm: true
        lnr_dims: !ref <d_model>

    encoder:
      type: transformer
      conf:
        posenc_dropout: !ref <trmf_dropout>
        posenc_scale: true
        emb_scale: true
        emb_layernorm: true
        d_model: !ref <d_model>
        num_heads: !ref <head_num>
        num_layers: !ref <layer_num>
        att_dropout: !ref <trmf_dropout>
        fdfwd_dim: !ref <fdfwd_dim>
        fdfwd_dropout: !ref <trmf_dropout>
        res_dropout: !ref <trmf_dropout>
        layernorm_first: true

    frontend:
      type: mel_fbank
      conf:
        sr: 22050
        mag_spec: False
        hop_length: 0.0125
        win_length: 0.05
        n_mels: 80

    normalize: True

    dec_prenet:
      type: linear
      conf:
        lnr_dims:
          - 256
          - 256
          - !ref <d_model>
        lnr_dropout: !ref <dropout>
        zero_centered: True

    decoder:
      type: transformer
      conf:
        posenc_dropout: !ref <trmf_dropout>
        posenc_scale: true
        emb_scale: true
        emb_layernorm: true
        d_model: !ref <d_model>
        num_heads: !ref <head_num>
        num_layers: !ref <layer_num>
        att_dropout: !ref <trmf_dropout>
        fdfwd_dim: !ref <fdfwd_dim>
        fdfwd_dropout: !ref <trmf_dropout>
        res_dropout: !ref <trmf_dropout>
        layernorm_first: true

    dec_postnet:
      type: conv1d
      conf:
        conv_dims: !list [512, -1, -1, -1, 0]
        conv_kernel: 5
        conv_batchnorm: true
        conv_activation: Tanh
        conv_dropout: !ref <dropout>

  criterion_conf:
    feat_loss_type: L2
    stop_pos_weight: 5.0
    f_beta: 2.0


optim_sches:
  type: noam.Noamlr
  conf:
    optim_type: Adam
    optim_conf:
      betas:
        - 0.9
        - 0.98
      eps: 1.0e-9
    warmup_steps: 16000